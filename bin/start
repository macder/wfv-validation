#!/bin/bash

## ---------------------------------
#  Define variables
#  ---------------------------------

declare DATABASE=(
  "wordpress_test" # DB Name
  "root"           # DB User
  "root"           # DB Pass
  "localhost"      # DB Host
)


declare WORDPRESS=(
  "4.7.3"
  true
)

declare SSH_TUNNEL=(
  "5555"           # Local Inbound Port
  "127.0.0.1"      # Localhost IP
  "3306"           # Local Outbound Port
  "vagrant"        # Remote User
  "192.168.33.10"  # Remote Host
)


## -------------------------------------
#  DO NOT EDIT VARIABLES PAST THIS POINT
#  -------------------------------------

declare MENU_MAIN=(
  "MAIN MENU"
  # "Database Settings"
  "SSH Tunnel For Remote DB"
  # "WordPress Settings"
  "Run Tests"
)

declare MENU_DATABASE=(
  "DATABASE"
  "NAME: "${DATABASE[0]}
  "USER: "${DATABASE[1]}
  "PASS: "${DATABASE[2]}
)

declare MENU_SSH_TUNNEL=(
  "SSH TUNNEL"
  # "Inbound Port: "${SSH_TUNNEL[0]}
  # "Localhost IP: "${SSH_TUNNEL[1]}
  # "Remote User: "${SSH_TUNNEL[2]}
  # "Remote Host: "${SSH_TUNNEL[3]}
  "Open Tunnel: ssh "${SSH_TUNNEL[0]}":"${SSH_TUNNEL[1]}":"${SSH_TUNNEL[2]}" "${SSH_TUNNEL[3]}"@"${SSH_TUNNEL[4]}
)

declare MENU_WORDPRESS=(
  "WORDPRESS"
  ${WORDPRESS[0]}
  "4.7.3"
  "4.7.2"
  "Other"
)

declare MENU_TESTS=(
  "UNIT TESTS"
  "ALL"
  "Input"
  "Form"
  # "Errors"
  # "Messages"
  "Validator"
)

RED='\033[0;41;30m'
STD='\033[0;0;39m'

#export CHOICE
# read input from the keyboard, store it in 'choice'
read_options(){
  items_in_menu=$1
  read -p "Enter choice [ 1 - $items_in_menu ] " choice
}

menu_main() {
  CURRENT_MENU=("${MENU_MAIN[@]}")
  show_menu CURRENT_MENU
  read_options $item_count

  case $choice in
    # 1) menu_database ;;
    # 2) menu_ssh ;;
    # 3) menu_wordpress ;;
    1) menu_ssh ;;
    2) menu_tests ;;
    3) exit 0 ;;
    *) echo -e "${RED}void choice${STD}" && sleep 0.1
  esac
}


menu_database() {
  CURRENT_MENU=("${MENU_DATABASE[@]}")
  show_menu CURRENT_MENU
  read_options $item_count

  # case $choice in
  #   1) ;;
  #   2) ;;
  #   3) ;;
  #   4) ;;
  #   *) echo -e "${RED}void choice${STD}" && sleep 0.1
  # esac
}

menu_ssh() {
  CURRENT_MENU=("${MENU_SSH_TUNNEL[@]}")
  show_menu CURRENT_MENU
  read_options $item_count

  case $choice in
    1) clear; ssh -f -N -L 5555:127.0.0.1:3306 vagrant@192.168.33.10; pause ;;
    2) exit 0 ;;
    0) menu_main ;;
    *) echo -e "${RED}void choice${STD}" && sleep 0.1
  esac
}

menu_wordpress() {
  CURRENT_MENU=("${MENU_WORDPRESS[@]}")
  show_menu CURRENT_MENU
  read_options $item_count

  case $choice in
    1) clear; bash ../../bin/install-wp-tests.sh wordpress_test root root 127.0.0.1:5555 latest true; pause ;;
    2) exit 0 ;;
    0) menu_main ;;
    *) echo -e "${RED}void choice${STD}" && sleep 0.1
  esac
}

menu_tests() {
  CURRENT_MENU=("${MENU_TESTS[@]}")
  show_menu CURRENT_MENU

  # bash lib/menu/sand.sh
  read_options $item_count

  case $choice in
    1) clear; bash lib/run.sh; pause ;;
    2) clear; bash lib/run.sh InputTest; pause ;;
    3) clear; bash lib/run.sh FormTest; pause ;;
    # 4) clear; bash lib/run.sh ErrorsTest; pause ;;
    # 5) clear; bash lib/run.sh MessagesTest; pause ;;
    4) clear; bash lib/run.sh ValidatorTest; pause ;;
    5) exit 0 ;;
    0) menu_main ;;
    *) echo -e "${RED}void choice${STD}" && sleep 0.1
  esac
}

pause(){
  read -p "Press [Enter] key to continue..." EnterKey
}

# function to display menus
show_menu() {
  local -n MENU_ITEMS="$1"
  MENU_NAME=${MENU_ITEMS[0]}
  bash lib/menu.sh "${MENU_ITEMS[@]}"
  item_count=${#MENU_ITEMS[@]}
}

# bash lib/menu.sh "${MENU_MAIN[@]}"

MENU_NAME=("MAIN MENU")
while true
do
  case $MENU_NAME in
    "MAIN MENU") menu_main ;;
    "DATABASE") menu_database ;;
    "SSH TUNNEL") menu_ssh ;;
    "UNIT TESTS") menu_tests ;;
  esac
done
